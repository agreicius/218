<section xml:id="sec_func_comp">
  <title>Function composition</title>
  <introduction>
    <p>
          <idx><h>Functions</h><h>Composition of Functions</h></idx>
    </p>
  </introduction>
  <subsection>
    <title>Learning Goals</title>
    <p>
      <ul>
      <li>
        <p>
          Understand what it means to compose two functions
        </p>
      </li>
      <li>
        <p>
          Calculate values of compositions of functions given tables, graphs,
          or formulas
        </p>
      </li>
      <li>
        <p>
          Simplify the formula for a composition of functions
        </p>
      </li>
      <li>
        <p>
          Determine the domain of a composition of functions
        </p>
      </li>
      <li>
        <p>
          See an example where composition of functions is vital to studying calculus
        </p>
      </li>
    </ul>
  </p>
  </subsection>
  <subsection>
    <title>Motivation and Examples</title>
    <p>
      Recall that a function, by definition,
      is a process that takes a collection of inputs and produces a corresponding collection of outputs in such a way that the process produces one and only one output value for any single input value.
      Because every function is a process,
      it makes sense to think that it may be possible to take two function processes and do one of the processes first,
      and then apply the second process to the result.
    </p>
    <p>
      Recall Dolbear's function, <m>F=f(N)=40+0.25N</m>,
      from Example <xref ref="ex_DolbearTake1" /> that relates the number <m>N</m> of chirps per minute from a snowy cricket to the Fahrenheit temperature,
      <m>F</m>.
    </p>
    <p>
      The Celsius and Fahrenheit temperature scales are connected by a linear function.
      Indeed, the function that converts Fahrenheit to Celsius is
      <me>
        C = g(F) = \frac{5}{9}(F-32)
      </me>
    </p>
    <p>
      For instance,
      a Fahrenheit temperature of 32 degrees corresponds to <m>C=g(32) = 0</m> degrees Celsius.
    </p>
    <p>
      If we are given a number of chirps, <m>N</m>,
      we can combine the two processes given by Dolbear's function and the conversion from Fahrenheit to Celsius to obtain a new function <m>C=h(N)</m> that takes as input the number of chirps per minute and gives as output the temperature in degrees Celsius.
    </p>
    <example>
      <statement>
        <p>
          Using Dolbear's model, what is the temperature in degrees Celsius assuming we observe crickets chirping at 80 chirps per minute? 
        </p>
      </statement>
      <solution>
        <p>
          First, we compute that the temperature in degrees Fahrenheit is
          <me>
            F = D(80) = 40+0.25(80) = 60
          </me>.
        </p>
        <p>
          It remains only to convert this Fahrenheit temperature to degrees Celsius:
          <me>
            C = G(60) = \frac{5}{9}(60-32) = \frac{140}{9} =15\frac{5}{9}^\circ C
          </me>.
          Thus, if crickets chirp at 80 chirps per minute, Dolbear's model predicts the temperature is <m>9^\circ C</m>.
        </p>
      </solution>
    </example>
    
    <example>
      <statement>
        <p>
          Determine a formula for the new function <m>C=h(N)</m> that takes as input the number <m>N</m> of cricket chirps per minute and gives as output the temperature <m>C</m> in degrees Celsius.
        </p>
        
      </statement>
      <solution>
        <p>
          Using <m>F=f(N)</m> as the input for the function <m>C=g(F)</m>,
          we simplify to find a formula directly from <m>N</m> to <m>C</m> that does not involve the variable <m>F</m>:
          <me>
            \begin{aligned}C \amp = g(F)\\ \amp = g(f(N))\\ \amp = \frac{5}{9}(f(N)-32)\\ \amp = \frac{5}{9}((40+0.25N)-32)\\ \amp =\frac{5}{9}(8+0.25N) \end{aligned}
          </me>
        </p>
        <p>
          So the function <m>C=h(N)</m> is given by
          <me>
            C = \frac{5}{9}(8+0.25N)
          </me>.
        </p>
      </solution>
    </example>
    <!-- <p>
      There is, of course,
      a shorthand notation for this process of using the output of <m>f</m> as the input of <m>g</m>:
      <me>
        h=g\circ f
      </me>.
    </p>
    <p>
      <m>g\circ f</m> is the function that first applies the process given by the function <m>D</m> and then applies the process given by the function <m>G</m>.
      Two natural questions we could begin by asking are:
    </p>
    "What is the domain of <m>H = G\circ D</m>?" <nbsp/><nbsp/> and <nbsp/><nbsp/> "What is the range of <m>H=G\circ D</m>?"
    <example>
      <statement>
        <p>
          Find the domain and range of the function <m>C=H(N)</m>.
        </p>
        <p>
          We established in Example <xref ref="ex_DolbearTake2" /> that <m>F=D(N)</m> has a domain of
          <m>[40,180]</m> cricket chirps per minute and a corresponding range of <m>[50,85]</m> degrees Fahrenheit.
        </p>
        <p>
          The domain for <m>H=G\circ D</m> is the inputs of <m>H</m>,
          so is also the inputs of <m>D</m> as that is the function that is applied first.
          Thus we can use the same set of <m>N</m>-values and the domain of <m>H</m> is also <m>[40,180]</m>.
        </p>
        <p>
          In order to determine the range,
          we must find the resulting degrees Celsius from the range of degrees Fahrenheit of <m>[50,85]</m>.
          <me>
            G(50) = \frac{5}{9}(50-32) = 10
          </me>
          and
          <me>
            G(85) = \frac{5}{9}(85-32) = \frac{265}{9}= 29\frac{4}{9}
          </me>.
          We know that a linear function's range will stay within these two values based on the shape of the graph.
          Thus the range of <m>H</m> is in degrees Celsius instead of Fahrenheit,
          and is <m>[10,29\frac{4}{9}]</m>.
        </p>
      </statement>
    </example> -->
  </subsection>
  <subsection>
    <title>Function composition</title><p>
      The function <m>h</m> explored in the examples above is called the <em>composition</em> of <m>f</m> and <m>g</m>, denoted <m>h=g\circ f</m>. Let's make this definition official. 
    </p>
    <definition xml:id="d_func_comp">
      <title>Function composition</title>
      <statement>
        <p>
          Given a function <m>f\colon B\rightarrow C</m>, and a function <m>g</m> with domain <m>A</m> satisfying <m>\range g\subseteq B</m>, 
          their <term>composition</term> <m>f\circ g</m> is the function 
          <m>
            f\circ g\colon A\rightarrow C
          </m>
          defined as 
          <men xml:id="eq_func_comp">
            f\circ g\, (a)=f(g(a))
          </men>
          for all <m>a\in A</m>. 
        </p>
      </statement>
    </definition>
    <figure xml:id="fig_comositionoffunctions">
      <caption>The composition <m>(f\circ g)(x) = f(g(x))</m> uses the outputs <m>g(x)</m> of <m>g</m> as the inputs of <m>f</m>.</caption>
      <image width="93%" source="CompositionOfFunctions.png"/>
    </figure>
    <remark>
      <title>Function composition</title>
      <p>
        Observe the important condition in the setup of a composition of two functions <m>f</m> and <m>g</m>: we need the range of <m>g</m> to be a subset of the domain of <m>f</m>. Let's think through why this must be the case. 
      </p>
      <p>
        By definition the composition function <m>h=f\circ g</m> takes an input <m>x</m> and maps it to the output 
        <me>
          h(x)=f(g(x))
        </me>.
        In order for this to make sense, we need <m>g(x)</m> to be in the domain of <m>f</m>. In other words, the outputs of <m>g</m> must lie in the domain of <m>f</m>: this is equivalent to saying that the range of <m>g</m> is a subset of the domain of <m>f</m>.
      </p>
    </remark>
    <warning>
      <title>Composition is not multiplication</title>
      <p>
        The notation <m>f\circ g</m> for function composition is similar looking to the notation <m>f\cdot g</m> for function multiplication. Do not conflate these two operations! Indeed, comparing <m>f\circ g\, (x)</m> and <m>f\cdot g\, (x)</m> at an arbitrary input, we see that 
        <md>
          <mrow>f\circ g\, (x) \amp =f(g(x))</mrow>
          <mrow>f\cdot g\, (x) \amp =f(x)g(x)</mrow>
        </md>,
        which are by no means the same thing.
      </p>
    </warning>
    <example xml:id="eg_comp_evaluation_form">
    <title>Composition: evaluation and formulas</title>
    <statement>
    <p>
    Let <m>f(x)=1/x</m> and <m>g(x)=1/(x^2+1)</m>. Define <m>h=f\circ g</m>. 
    <ol>
      <li>
        <p>
          Compute <m>h(-3)</m>. 
        </p>
      </li>
      <li>
        <p>
          Find a formula for <m>h(x)</m>. 
        </p>
      </li>
    </ol>
    </p>
    </statement>
    <solution>
    <p>
    <ol>
      <li>
        <p>
          By definition, we have 
          <md>
            <mrow>h(-3) \amp =f(g(-3))</mrow>
            <mrow> \amp =f\left(\frac{1}{10}\right)\amp g(-3)=\frac{1}{(-3)^2+1}=\frac{1}{10}</mrow>
            <mrow> \amp =\frac{1}{\frac{1}{10}}</mrow>
            <mrow> \amp = 10</mrow>
          </md>. 
        </p>
      </li>
      <li>
        <p>
          The formula for <m>h</m> is computed in much the same way as above, replacing <m>-3</m> with the variable <m>x</m>:
          <md>
            <mrow>h(x) \amp =f(g(x))</mrow>
            <mrow> \amp =f\left(\frac{1}{x^2+1}\right)</mrow>
            <mrow> \amp =\frac{1}{\frac{1}{x^2+1}}</mrow>
            <mrow> \amp =x^2+1</mrow>
          </md>.
        </p>
      </li>
      <li>
        <p>
          The implied domain of <m>h</m> is the set of <m>x\in \R</m> for which <m>g</m> is defined at <m>x</m> and <m>f</m> is defined at <m>g(x)</m>. The function <m>g</m> is defined at <m>x</m> as long as <m>x^2+1</m> is nonzero; but this is true for all <m>x</m>, since <m>x^2+1\geq 1</m> for all <m>x</m>. Similarly, the expression <m>f(g(x))=1/g(x)</m> is defined as long as <m>g(x)</m> is nonzero. As already observed, this is true for all <m>x</m>. Thus the implied domain of <m>h</m> is <m>\R</m>.  
        </p>
      </li>
    </ol>
    </p>
    </solution>
    </example>
    <example xml:id="eg_func_comp_order">
    <title>Composition: order matters</title>
    <statement>
    <p>
    Define 
    <md>
      <mrow>f\colon \R \amp \rightarrow \R \amp g\colon \R\amp \rightarrow \R</mrow>
    </md>
    as <m>f(x)=x^2+1</m> and <m>g(x)=-2x+1</m>.
    <ol>
      <li>
        <p>
          Compute formulas for <m>f\circ g</m> and <m>g\circ f</m>. 
        </p>
      </li>
      <li>
        <p>
         Do we have <m>f\circ g=g\circ f</m>? 
        </p>
      </li>
    </ol>
    </p>
    </statement>
    <solution>
    <p>
    <ol>
      <li>
        <p>
          We compute 
          <md>
            <mrow>f\circ g\, (x) \amp =f(g(x))</mrow>
            <mrow> \amp = f(-2x+1)</mrow>
            <mrow> \amp = (-2x+1)^2+1 </mrow>
            <mrow> \amp = 4x^2-4x+2</mrow>
            <mrow>g\circ f\, (x) \amp =g(f(x))</mrow>
            <mrow> \amp = g(x^2+1)</mrow>
            <mrow> \amp = -2(x^2+1)+1 </mrow>
            <mrow> \amp = -2x^2-1</mrow>
          </md>.
        </p>
      </li>
      <li>
        <p>
          From the above we see that <m>f\circ g</m> and <m>g\circ f</m> are both quadratic polynomials. Recall that two polynomials of the same degree are equal as functions if and only if their coefficients are all equal. (See <xref ref="cor_poly_equality"/>.) Comparing coefficients above, we see easily that <m>f\circ g\ne g\circ f</m>. 
        </p>
        <p>
          Moral of the story: the order of composition matters! That is, the function <m>f\circ g</m> is not necessarily the same as <m>g\circ f</m>. 
        </p>
      </li>
    </ol>
    </p>
    </solution>
    </example>
    <remark>
      <title>Inner/outer function</title>
      <p>
        The function <m>g</m> in a composition <m>h=f\circ g</m> is often called the <q>inner function</q> of the composition, and <m>f</m> is called the <q>outer function</q>. This terminology derives naturally from the definition
        <men xml:id="eq_inner_outer">
          h(x)=\overset{\text{outer}}{\overbrace{f(\underset{\text{inner}}{\underbrace{g(x)}})}}
        </men>.
         Alternatively, we can use sequential language when describing the roles of <m>f</m> and <m>g</m> in the composition <m>f\circ g</m>. That is, when computing <m>h(x)</m> using definition <xref ref="eq_inner_outer"/>, we <em>first</em> evaluate <m>g</m> at <m>x</m> to produce the output <m>g(x)</m>, and <em>then</em> evaluate <m>f</m> at <m>g(x)</m> to produce the output <m>f(g(x))</m>. 
      </p>
      <p>
        This sequential way of looking at composition is especially helpful when trying to describe a given function <m>h</m> as a composition <m>h=f\circ g</m> of two functions.    
      </p>
    </remark>
    <example xml:id="eg_h_comp">
    <title>Expressing functions as compositions</title>
    <statement>
    <p>
    Express the given function <m>h</m> as a composition <m>h=f\circ g</m>. Give explicit formulas for your choice of <m>f</m> and <m>g</m>. 
    <ol>
      <li>
        <p>
          <m>h(x)=\sqrt{x^2+x+1}</m>
        </p>
      </li>
      <li>
        <p>
          <m>h(x)=\frac{1}{3x-7}</m>
        </p>
      </li>
    </ol>
    </p>
    </statement>
    <solution>
    <p>
    <ol>
      <li>
        <p>
          The particular form of the of the formula here strongly suggests the the <q>outer function</q> <m>f</m> should be <m>f(x)=\sqrt{x}</m>, and the <q>inner function</q> <m>g</m> should be <m>g(x)=x^2+x+1</m>. Let confirm that <m>h=f\circ g</m>: for all <m>x</m>, we have 
          <md>
            <mrow>f(g(x)) \amp =\sqrt{g(x)} \amp (f(x)=\sqrt{x})</mrow>
            <mrow> \amp =\sqrt{x^2+x+1} \amp (g(x)=x^2+x+1)</mrow>
            <mrow> \amp =h(x)</mrow>
          </md>
          for all <m>x\in \R</m>. This proves <m>h=f\circ g</m>. 
        </p>
      </li>
      <li>
        <p>
          In this example the <q>inner function</q> and <q>outer function</q> is less obvious. Let's use the sequential description of function composition to help us out. Looking at the formula for <m>h</m>, we see that to evaluate <m>h</m> at a given <m>x</m>, we must <em>first</em> compute <m>3x-7</m>, and <em>then</em> compute the reciprocal of this expression <m>1/(3x-7)</m>. Thus suggests that we should set <m>g(x)=3x-7</m> and <m>f(x)=1/x</m>. Let's check that our choice of <m>f</m> and <m>g</m> work: we have 
          <md>
            <mrow>f(g(x)) \amp =f(3x-7) \amp (g(x)=3x-7)</mrow>
            <mrow> \amp =\frac{1}{3x-7} \amo (f(x)=1/x)</mrow>
            <mrow> \amp =h(x)</mrow>
          </md>
          for all <m>x</m> in the implied domain of <m>h</m>. Thus <m>h=f\circ g</m>. 
        </p>
      </li>
    </ol>
    </p>
    </solution>
    </example>
    <p>
      The next two examples illustrate how to compute values of a composition of functions when the function information is provided by tables or graphs. 
    </p>
    <example xml:id="eg_func_comp_tables">
      <title>Composition: using tables</title>
      <statement>
        <p>
          Suppose that <m>f</m> and <m>g</m> are given by the table
        </p>
          <image width="28%" source="APCTable1-6-3.png"/>
        <p>
          <ol>
            <li>
              <p>
                Compute the given expression or else explain why the tables do not provide enough information. 
                <ol cols="3">
                  <li>
                    <p>
                      <m>f\circ g\, (2)</m>
                    </p>
                  </li>
                  <li>
                    <p>
                      <m>g\circ f\, (2)</m>
                    </p>
                  </li>
                  <li>
                    <p>
                      <m>g\circ f\, (0)</m>
                    </p>
                  </li>
                </ol>
              </p>
            </li>
            <li>
              <p>
                Find all solutions to <m>f\circ g\, (x)=6</m> lying in the set <m>\{0,1,2,3,4\}</m>.
              </p>
            </li>
            <li>
              <p>
                Find all solutions to <m>g\circ f\, (x)=2</m> lying in the set <m>\{0,1,2,3,4\}</m>.
              </p>
            </li>
          </ol>
        </p>
      </statement>
      <solution>
        <p>
          <ol>
            <li>
              <p>
                We compute 
                <md>
                  <mrow>f\circ g\, (2) \amp =f(g(2))</mrow>
                  <mrow> \amp = f(0) \amp (g(2)=0)</mrow>
                  <mrow> \amp = 6</mrow>
                </md>
                and 
                <md>
                  <mrow>g\circ f\, (2) \amp = g(f(2))</mrow>
                  <mrow> \amp =g(3) \amp (f(2)=3)</mrow>
                  <mrow> \amp = 4</mrow>
                </md>.
                On the other hand, we do not have enough information from the table to compute <m>g\circ f\, (6)</m> since <m>f(0)=6</m> and the table does not indicate what <m>g(6)</m> is. 
              </p>
            </li>
            <li>
              <p>
                First observe that <m>f(x)=6</m> for <m>x=0,4</m>. Thus for <m>f(g(x))=6</m> for <m>x\in \{0,1,2,3,4\}</m>, we need to find the <m>x</m> in this set such that <m>g(x)=0</m> or <m>g(x)=4</m>. From the table we see that <m>g(2)=0</m> and <m>g(3)=4</m>. Thus <m>x=2,3</m> are the two solutions to the equation <m>f\circ g\, (x)=6</m> lying in the set <m>\{0,1,2,3,4\}</m>. 
              </p>
            </li>
            <li>
              <p>
                Our reasoning is similar to the previous part. Since <m>g(x)=4</m> for <m>x=4</m> and since the solutions to <m>f(x)=4</m> for <m>x\in \{0,1,2,3,4\}</m> are <m>x=1</m> and <m>x=3</m>, these are the solutions to <m>g\circ f\, (x)=2</m> lying in <m>\{0,1,2,3,4\}</m>. 
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>
    
    <example xml:id="eg_comp_graphs">
      <title>Composition: using graphs</title>
      <statement>
        <p>
          The graphs of functions <m>p</m> and <m>q</m> are given below. 
        </p>
          <image width="50%" source="APCFigure1-6-4.png"/>
        <p>
          Compute the following function values.
        <ol>
          <li>
            <p>
            <m>p\circ q\, (0)</m>.
            </p>
          </li>
          <li>
            <p>
              <m>q\circ p\, (0)</m>
            </p>
          </li>
          <li>
            <p>
              <m>p\circ p \, (-3/2)</m>
            </p>
          </li>
        </ol>
        </p>
      </statement>
      <solution>
        <p>
          <ol>
            <li>
              <p>
                We have 
                <md>
                  <mrow>p\circ q\, (0) \amp = p(q(0))</mrow>
                  <mrow> \amp = p(2)</mrow>
                  <mrow> \amp = 2</mrow>
                </md>.
              </p>
            </li>
            <li>
              <p>
                We have 
                <md>
                  <mrow>q\circ p\, (0) \amp = q(p(0))</mrow>
                  <mrow> \amp = q(-1/2)</mrow>
                  <mrow> \amp = 2 </mrow>
                </md>.
              </p>
            </li>
            <li>
              <p>
                We have 
                <md>
                  <mrow>p\circ p\, (-3/2) \amp = p(p(-3/2))</mrow>
                  <mrow> \amp = p(0)</mrow>
                  <mrow> \amp = -1/2</mrow>
                </md>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>

  </subsection>
  <subsection>
    <title>Implied domain of compositions</title>
    <p>
        How do we determine the implied domain of a composition <m>f\circ g</m> of two functions? For <m>f(g(x))</m> to be defined at <m>x</m>, we need <em>two</em> conditions to hold:
        <ol>
          <li>
            <p>
              <m>g</m> is defined at <m>x</m>; 
            </p>
          </li>
          <li>
            <p>
              <m>f</m> is defined at <m>g(x)</m>.
            </p>
          </li>
        </ol>
        Thus the implied domain <m>D</m> of <m>f\circ g</m> is the set of <m>x\in \R</m> for which both <m>g(x)</m> and <m>f(g(x))</m> are defined. Using set intersection notation (see <xref ref="d_union_intersection"/>), we have 
        <me>
          D=\{x\in \R \mid g \text{ defined at } x\}\cap \{x\in \R \mid f \text{ defined at } g(x)\}
        </me>.
        Let's compute some simple examples. After we develop techniques for solving inequalities, we will consider more complicated examples. 
      </p>
    <example xml:id="eg_comp_implied_domain">
      <title>Composition: implied domain</title>
      <statement>
        <p>
          Let <m>f(x)=1/x</m> and <m>g(x)=\sqrt{x+1}</m>. 
          Find the implied domain of <m>f\circ g</m>. 
        </p>
      </statement>
      <solution>
        <p>
          The implied domain of <m>f\circ g</m> is the set of <m>x</m> where <m>g(x)=\sqrt{x+1}</m> is defined <em>and</em> where <m>f(g(x))=1/\sqrt{x+1}</m> is defined. 
        </p>
        <p>
          For <m>g(x)=\sqrt{x+1}</m> to be defined, we need <m>x+1\geq 0</m>, or equivalently <m>x\geq -1</m>. 
        </p>
        <p>
          For <m>f(g(x))=1/\sqrt{x+1}</m> to be defined, we need further that <m>\sqrt{x+1}\ne 0</m>, or equivalently, <m>x\ne -1</m>. 
        </p>
        <p>
          Thus both conditions are satisfied if and only if <m>x\in [-1,\infty)</m> and <m>x\ne -1</m>. In other words, the implied domain of <m>f\circ g</m> is <m>(-1,\infty)</m>. 
        </p>
      </solution>
    </example>
    
    <example xml:id="eg_comp_implied_domain_2">
      <title>Composition: implied domain</title>
      <statement>
        <p>
          Let <m>f(x)=x^2-1</m> and <m>g(x)=3x-\tfrac{4}{x}</m>. 
          <ol>
            <li>
              <p>
                Find the implied domain of <m>f\circ g</m>. 
              </p>
            </li>
            <li>
              <p>
                Find the implied domain of <m>g\circ f</m>.
              </p>
            </li>
          </ol>
        </p>
      </statement>
      <solution>
        <p>
          <ol>
            <li>
              <p>
                The function <m>g</m> is defined for all <m>x\ne 0</m>. Since <m>f</m> is defined everywhere, there is not further constraint. Thus the implied domain is 
                <me>
                  \{x\in \R\mid x\ne 0\}
                </me>.
              </p>
            </li>
            <li>
              <p>
                For <m>g\circ f</m> to be defined at <m>x</m> we need <m>f</m> to be defined at <m>x</m> and <m>g</m> to be defined at <m>f(x)</m>. As mentioned above, <m>f</m> is defined everywhere, so the first condition creates no restriction. Since <m>g</m> is defined only when the input is nonzero, we need <m>f(x)\ne 0</m> for <m>g</m> to be defined at <m>f(x)</m>. The usual algebra shows that <m>f(x)=0</m> if and only if <m>x=\pm 1</m>. We conclude that the domain of <m>g\circ f</m> is 
                <me>
                  \{x\in \R\mid x\ne \pm 1\}=(-\infty, -1)\cup (-1,1)\cup (1,\infty)
                </me>.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>
    <warning>
      <title>Composition: implied domain</title>
      <p>
       When computing the formula for a composition <m>f\circ g</m>, there is always the danger of overlooking what the implied domain is. Consider the example where we take <m>f(x)=g(x)=1/x</m>. Our usual implied domain analysis yields that the implied domain of <m>h=f\circ g</m> is the set of all <m>x\ne 0</m>. However, if computing a formula for <m>h</m>, we see that 
       <md>
        <mrow>h(x) \amp =f(g(x))</mrow> 
        <mrow> \amp =f(1/x)</mrow>
        <mrow> \amp =1/(1/x))</mrow>
        <mrow> \amp = x</mrow>
       </md>,
       suggesting that the implied domain of <m>h=f\circ g</m> should be <m>\R</m>. How do we reconcile these two different conclusions? Here's how: the steps in the algebra above used to compute the formula for <m>h</m> are only valid for inputs <m>x</m> where <m>f</m> and <m>g</m> are defined in the first place! In other words, our identity <m>h(x)=x</m> is itself only true for <m>x\ne 0</m>, and this is consistent with our determination of the implied domain. 
      </p>
    </warning>
  </subsection> 
  <!-- <subsection>
    <title>Function Composition and Average Rate of Change</title>
    <p>
      In this section,
      we see how the idea of composition can be used in concert with the formula for average rate of change.
      You have already seen a few WeBWorK problems that involve doing this!
      Hopefully this section clears up any lingering confusion.
    </p>
    <p>
      Recall that the average rate of change of a function <m>f</m> on the interval <m>[a,b]</m> is given by
      <me>
        AV_{[a,b]} = \frac{f(b)-f(a)}{b-a}
      </me>.
      In the figure below, we see the familiar representation of
      <m>AV_{[a,b]}</m> as the slope of the line joining the points <m>(a,f(a))</m> and
      <m>(b,f(b))</m> on the graph of <m>f</m>.
      In the study of calculus,
      we progress from the <em>average rate of change on an interval</em>
      to the <em>instantaneous rate of change</em>
      of a function at a single value
      (what we might want to call the "slope" of a nonlinear curve).
      The core idea that allows us to move from an <em>average</em>
      rate to an <em>instantaneous</em>
      one is letting the interval <m>[a,b]</m> shrink in size.
    </p>
    <p>
      To think about the interval <m>[a,b]</m> shrinking while <m>a</m> stays fixed,
      we often change our perspective and think of <m>b</m> as <m>a+h</m>,
      where <m>h</m> measures the horizontal difference from <m>b</m> to <m>a</m>.
      See <xref ref="fig_abtoaplush" /> below.
    </p>
    <figure xml:id="fig_abtoaplush">
      <caption>Think of the interval <m>[a,b]</m> as the interval <m>[a,a+h]</m>.</caption>
      <image width="70%" source="APCFigure1-6-7-8.png"/>
    </figure>
    <p>
      This allows us to eventually think about <m>h</m> getting closer and closer to <m>0</m>,
      and in that context we consider the equivalent expression
      <me>
        AV_{[a,a+h]}  = \frac{f(a+h)-f(a)}{(a+h)-a} =\frac{f(a+h)-f(a)}{h}
      </me>
      for the average rate of change of <m>f</m> on <m>[a,a+h]</m>.
    </p>
    <p>
      In this most recent expression for <m>AV_{[a,a+h]}</m>,
      we see the important role that the composite function "<m>f(a+h)</m>" plays.
      In particular, to understand the expression for
      <m>AV_{[a,a+h]}</m> we need to evaluate <m>f</m> at the quantity <m>(a+h)</m>.
    </p>
    <example xml:id="ex_APC1-6-9">
      <statement>
        <p>
          Suppose that <m>f(x) = x^2+1</m>.
          Determine the simplest possible expression you can find for <m>AV_{[3,3+h]}</m>,
          the average rate of change of <m>f</m> on the interval <m>[3,3+h]</m>.
        </p>
      </statement>
      <solution>
        <p>
          By definition, we know that
          <me>
            AV_{[3,3+h]} = \frac{f(3+h)-f(3)}{h}
          </me>
        </p>
        <p>
          Using the formula for <m>f</m>,
          we have <m>f(3+h) = (3+h)^2+1</m> and <m>f(3) = 3^2+1</m>, so that
          <me>
            AV_{[3,3+h]} = \frac{((3+h)^2+1)-(3^2+1)}{h}
          </me>
        </p>
        <p>
          Expanding the numerator and combining like terms, it follows that
          <me>
            \begin{aligned}AV_{[3,3+h]} \amp = \frac{9+6h+h^2+1-10}{h}\\ \amp = \frac{6h+h^2}{h}\\ \amp =\frac{h(6+h)}{h}\\ \amp = 6+h. \end{aligned}
          </me>
        </p>
        <p>
          Hence <m>AV_{[3,3+h]} = 6+h</m>,
          which is the average rate of change of
          <m>f(x) = x^2+1</m> on the interval <m>[3,3+h]</m>.
        </p>
      </solution>
    </example>
    <exercise>
      <statement>
        <ol marker="labelalphitemsep10pt">
          <li>
            <p>
              Rewrite each interval <m>[3,4]</m>, <m>[3,3.5]</m>,
              <m>[3,3.1]</m> in the form <m>[3,3+h]</m> for some value of <m>h</m>.
              What is <m>h</m> for each interval.
            </p>
          </li>
          <li>
            <p>
              Confirm the formula <m>AV_{[3,3+h]}=6+h</m> from <xref ref="ex_APC1-6-9">Example</xref>
              by calculating the average rate of change of
              <m>f(x) = x^2+1</m> on <m>[3,4]</m>, <m>[3,3.5]</m>,
              and <m>[3,3.1]</m> using the original formula
              <m>AV_{[a,b]} = \frac{f(b)-f(a)}{b-a}</m> and comparing it to the value of <m>6+h</m>.
            </p>
          </li>
          <li>
            <p>
              What would you estimate the "instantaneous" rate of change of <m>f(x) = x^2+1</m> at <m>x=3</m> to be,
              based on this calculation?
              Remember that the instantaneous rate of change is what we get as we let the interval <m>[3,3+h]</m> get smaller and smaller.
            </p>
          </li>
        </ol>
      </statement>
    </exercise>
  </subsection>
  <subsection>
    <title>Summary</title>
    <p>
      The following terms were introduced in this section:
    </p>
    composition of functions, instantaneous rate of change
    <p>
      <em>Key ideas:</em> The composition
      <m>(f\circ g)(x) = f(g(x))</m> means to use <m>g(x)</m> as the input of the function <m>f</m>.
      The domain of <m>f\circ g</m> is a subset of the domain of <m>g</m> so that <m>g(x)</m> is in the domain of <m>f</m>.
    </p>
    <p>
      <em>Other ideas introduced:</em>
      Composition of functions plays an important role in defining the instantaneous rate of change of a function,
      which is a central idea in calculus.
    </p>
    <p>
      \fbox{\fbox{ End of Section 1.9}}
    </p>
    <p>
      \rule{1.1\textwidth}{2pt}
    </p>
  </subsection> -->
</section>